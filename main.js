(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,r,n,o,c,a,u,i){var l=e.querySelector(".places__item").cloneNode(!0),s=l.querySelector(".card__image");s.addEventListener("click",o);var d=l.querySelector(".card__delete-button");c!==t.owner._id&&d.remove(),d.addEventListener("click",(function(){return r(t._id,a)}));var p=l.querySelector(".card__title"),m=l.querySelector(".card__like-button");return l.querySelector(".like_count").textContent=t.likes.length,m.addEventListener("click",(function(){return n(t._id,u,i)})),p.textContent=t.name,s.src=t.link,s.alt=t.name,l.id=t._id,l}function r(e,t){document.getElementById("".concat(e)).remove(),t(e)}function n(e,t,r){var n=document.getElementById("".concat(e)).querySelector(".card__like-button");n.classList.contains("card__like-button_is-active")?(n.classList.remove("card__like-button_is-active"),r(e)):(n.classList.add("card__like-button_is-active"),t(e))}function o(e){"Escape"==e.key&&null!==document.querySelector(".popup_is-opened")&&a(document.querySelector(".popup_is-opened"))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(e){null!==document.querySelector(".popup_is-opened")&&e.target===e.currentTarget&&a(document.querySelector(".popup_is-opened"))}))}));var u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-11",headers:{authorization:"4305860c-01fd-4fb6-abcb-1140ebdec787","Content-Type":"application/json"}},i=function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},l=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=document.querySelector(".places__list"),m=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),_=document.querySelector(".popup_type_avatar"),y=document.querySelectorAll(".popup__close"),v=document.forms.new_place,h=document.forms.edit_profile,b=document.forms.new_avatar,S=b.elements.link;document.querySelector(".profile__image").addEventListener("click",(function(){c(_)})),b.addEventListener("submit",(function(e){e.preventDefault();var t=S.value;O.style="background-image: url("+t+");",function(e){fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t),a(_)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){c(f)}));var q=v.elements.place_name,k=v.elements.link,E=h.elements.name,g=h.elements.description,L=document.querySelector(".profile__title"),j=document.querySelector(".profile__description");document.querySelector(".profile__edit-button").addEventListener("click",(function(){c(m),E.value=L.textContent,g.value=j.textContent})),y.forEach((function(e){e.addEventListener("click",(function(){a(e.closest("div.popup"))}))}));var C=document.querySelector(".popup_type_image"),A=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption");function w(e){c(C);var t=e.target.getAttribute("src"),r=e.target.getAttribute("alt");A.src=t,A.alt=r,P.textContent=r}var x,T=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),O=document.querySelector(".profile__image");function D(e){e.forEach((function(e){var o=t(e,r,n,w,x,i,l,s);return p.prepend(o)}))}var I=document.querySelector(".popup_type_edit");h.addEventListener("submit",(function(e){e.preventDefault();var t,r,n=E.value,o=g.value;T.textContent=E.value,U.textContent=g.value,t=n,r=o,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),a(I)}));var N=document.querySelector(".popup_type_new-card");v.addEventListener("submit",(function(e){e.preventDefault();var o,c,d={link:"".concat(k.value),name:"".concat(q.value)};o=d.name,c=d.link,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:o,link:c}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))});var m=t(d,r,n,w,x,i,l,s);return q.value="",k.value="",a(N),p.prepend(m)})),document.querySelector(".profile__image"),document.querySelectorAll(".popup__input").forEach((function(e){e.addEventListener("input",(function(){return function(e){if(e.validity.patternMismatch?e.setCustomValidity(e.dataset.error):e.setCustomValidity(""),e.validity.valid){!function(e){e.classList.remove("form__input_type_error"),e.closest("label.form__field").querySelector(".form__input-error").textContent=""}(e);var t=e.closest("form.popup__form");null===t.querySelector(".form__input_type_error")&&(t.querySelector(".popup__button").disabled=!1)}else r=e,n=e.validationMessage,r.classList.add("form__input_type_error"),r.closest("label.form__field").querySelector(".form__input-error").textContent=n,e.closest("form.popup__form").querySelector(".popup__button").disabled=!0;var r,n}(e)}))})),Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{method:"GET",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})),fetch("".concat(u.baseUrl,"/cards"),{method:"GET",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e}))]).then((function(e){var t,r,n,o=(n=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,a,u=[],i=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=c.call(r)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(r,n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];t=c,T.textContent=t.name,U.textContent=t.about,O.style="background-image: url("+t.avatar+");",x=t._id,D(a)}))})();